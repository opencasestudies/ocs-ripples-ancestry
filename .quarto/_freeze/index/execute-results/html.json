{
  "hash": "f974959cc37707423e107f05bf4ad06b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Open Case Studies: The Biology of Ancestry\"\noutput:\n  html_document\n---\n\n#### {.outline}\n\n![](img/mainplot.png){fig-alt=\"\" width=800 .lightbox}\n\n####\n\nAdd disclaimer and license\n\n\n#### {.reference_block}\n\nTo cite this case study, please use:\n\nKate Isaac, Hanako Osuga, Jeanne Chowning, Wright, Carrie (2026). https://github.com/opencasestudies/ocs-ripples-ancestry. The Biology of Ancestry (Version v1.0.0).\n\n####\n\nTo access the GitHub repository to see teh source materials and data that went into making the case study, please see here: https://github.com/opencasestudies/ocs-ripples-ancestry.\nThis case study is published as part of the [Reducing Inequities by Promoting Participatory Learning Experiences in Sciences (RIPPLES) Project](https://www.fredhutch.org/en/news/center-news/2024/09/science-education-partnership-ripples-grant.html) funded in part by R25GM15358, a Science Education Partnership Award (SEPA) from the National Institute of General Medical Sciences (NIGMS). The contents of this case study are solely the responsibility of the authors and do not represent the official views of the Fred Hutch, NIGMS, or NIH.\n\n# **Motivation**\n***\n\nThis case study explores human *genomic variation*, especially with respect to *ancestry*.\n\n<!--\n  Add definition box with tabs for genomic variation and ancestry\n-->\n\nThe human genome is composed of stretches of *nucleotides (A,C,G,T)*.  Genomic variation is caused by single-nucleotide changes (“point mutations”) or larger structural changes (duplication, insertion, deletion, inversion, translocation, etc.)\n\n<!--\n  Add definition box for nucleotides\n-->\n\nAn example of a single nucleotide change would be A → G. (Add box about transition vs transversion.?) If a point mutation occurs fairly often within a population such that it is observed with a common frequency, it is termed a single nucleotide polymorphism or SNP. An example of a structural change would be a duplication where ACCGT would be duplicated and become ACCGTACCGT (though structural variants are typically defined as involving more than 50 nucleotides at a time). Some large structural changes may occur across multiple chromosomes (inter-chromosomal) rather than being within a single chromosome (intra-chromosomal).\n\n<!--\n  [Add figure showing examples of structural variants – simplifications of figure 1 here: https://pmc.ncbi.nlm.nih.gov/articles/PMC7131885/]\n-->\n\nVariation can be introduced through *mutation* or *recombination* during *meiosis*. Mutations may occur due to errors during the *replication* of genomic material, imperfect repair mechanisms, environmental factors or *mutagens* that damage genomic material (e.g., high-energy radiation or certain chemicals or viruses), or spontaneous changes. Not all variation will be passed on to offspring/children. Mutations may be somatic (occurring in cells that are not part of the reproductive system) or germline (occurring in cells that are part of the reproductive system). Germline mutations and meiotic recombination are examples of *heritable* variation that will be passed on to future generations.\n\n<!--\n  Add definition box with tabs for mutation, recombination, meiosis, replication, mutagens, and heritable\n-->\n\nHuman genomes are large! And most of the genome is identical when comparing two individuals or an individual to a *reference genome*. On average if you compared the genomes of two individuals, there would be around 99.5% identity or matching between the two. This is often visualized with a *dotplot* where highly identical genomes will have a dense, diagonal line with some off diagonal dots.\n\n<!--\n  Add definition box with tabs for reference genome and dotplot\n-->\n\n<!--\nAdd figure showing identity\n-->\n\n## Why is variation important?\n\nWhy should we care about human genomic variation, especially if there’s so much identity? Some variation is “functional” and leads to changes not just in the genome, but also in the *proteins* that are *translated* from the genetic material; however, not all variation is “functional”. These functional changes may impact how much of a protein is made, the protein structure and therefore its eventual role in the *cell*, or where and when the protein is expressed due to changes in regulatory elements. Certain diseases may be caused or worsened by genetic variation. Cancer is a common example of this where genes that control cell growth, division, or scheduled cell death are mutated and their proteins do not function properly to control this cell cycle, leading to tumors. For other diseases, (such as sickle-cell anemia and the Hemoglobin protein), a protein may not be expressed at the correct levels or the protein may be folded incorrectly because of its mutated structure, leading to inefficiencies in or the inability of the protein to perform its cellular essential function(s). Biological redundancy acts as a safety net such that the cell has backup systems that can mitigate issues by compensating or taking the place of nonfunctional components. But even with redundancy systems, mutations can lead to small changes with major consequences\n\n<!--\n  Add definition box with tabs for functional, proteins, translated, cell\n-->\n\n<details><summary>Different types of mutations</summary>\n\n**Single-nucleotide changes**\n\nDifferent types of single-nucleotide mutations are defined based on the effect of the mutation.\n\n* **Silent mutations** have an underlying nucleotide change, but the *amino acid* building blocks of the protein remain unchanged. Not only does the protein remain unchanged, but for a true \"silent\" mutation, there is no effect on the cell.\n* **Synonymous mutations**: Synonymous mutations have an underlying nucleotide change, and the amino acid building blocks of the protein remain unchanged. They differ from silent mutations, however, because these have an impact on the cell. This impact could be due to how often a protein is produced because certain *codons* are less available or may take longer to process in translation; so while these mutations code for the same amino acid, they have an effect in the cell and aren't considered \"silent\".\n* **Missense mutations** result in an amino acid substitution which can impact protein structure and function.\n  * Some missense mutations are **“conservative”** where the amino acid substitution is switching one amino acid for another similar one with similar biochemical properties (e.g., size, charge, etc.).\n  * A **“non-conservative”** missense mutation switches an amino acid to one with dissimilar biochemical properties – this is likely to have a greater impact on protein structure and function than a conservative missense mutation.\n* **Nonsense mutations** introduce an early *stop codon* halting translation and producing a truncated, likely nonfunctional protein.\n\n**Single-nucleotide insertions or deletions (indels)**\n\nA single nucleotide insertion or deletion (or one that is a length not a multiple of three -- 3 is the length of a codon) may introduce a **frameshift mutation**. Frameshift mutations often impact structure and function to a higher degree than missense mutations because these cause downstream impacts, shifting the reading frame during translation for all subsequent codons.\n\n</details>\n\nGenetic variation isn’t of interest solely because of mutation and its relation to disease. Genetic variation is also considered necessary for survival. The Red Queen Hypothesis stipulates that species must constantly evolve and adapt to survive, especially when competing with other species (e.g., predators vs prey, virus-host interactions, etc.). Given this, heritable variation (e.g., germline mutations or recombination during meiosis) is beneficial to the species by supporting evolution, allowing for the selection of advantageous traits necessary for adaptation and survival either due to competition or novel locations with their share of environmental challenges and unique resources. In other words, evolution depends upon the random accidents and mistakes that are mutations being maintained within a population because of the non-random survival due to the changes being advantageous.\n\n## Finding Relatedness\n\nEveryone within the human species inherited genomic material from two individuals and each of those individuals inherited genomic material from two other individuals, continuing backwards through the family history. And by expanding this to consider the evolution of species, this history traces back to shared or common ancestors of different species. If we consider two humans, we won’t have to go very far back to find a common ancestor, but comparing a human with an organism from another species, we will have to go back a longer amount of time to find a common ancestor. Since genomic material is what is passed down from ancestors, genomic material is what is compared when considering ancestry and how individuals and species are related. Individuals that are more closely related will share more genomic material in common than those that are more distantly related. When comparing genomic material between individuals, sequence similarity or identity is a quantitative measure describing how much overlap or matching there is between the genomic material. Homology is a qualitative description inferred from the amount of similarity and suggests that the sequences or genomic material share a common ancestor. Models used to compare sequences take into account the different kinds of mutations and how commonly they occur.\n\n# **Main Questions**\n***\nList inside the main question block the main questions that we seek to answer with the case study analysis:\n\n#### {.main_question_block}\n<b><u> Our main question: </u></b>\n\n1) How can genomic data be used to explore the ancestry of an individual or population?\n2) How does the genetic makeup of different world populations compare?\n3) How can coding and computational biology/data science principles and tools help us investigate our question?\n\n####\n\n# **Learning Objectives**\n***\n\n<u>**Data Science Learning Objectives:**</u>\n\n1. Explain the differences and benefits of using R vs Google Sheets to work with data\n2. Describe how data can take different shapes: long and wide\n3. Recode data to change original values, using programming to reduce accidents\n4. Crease an ancestry plot (a special heatmap-like column plot that shows differences)\n5. Describe what different elements of the ancestry plot represent\n6. Combine two plots together\n\n<u>**Statistical Learning Objectives:**</u>\n\n1. Explain how clustering can help identify groups\n2. Summarizing means within a dataset\n\n<u>**Topical Learning Objectives:**</u>\n\n1. Describe how genomic data shows what human variation looks like\n2. Explain genetic similarities and differences between people\n3. Describe how racial and ancestry groups might differ\n4. Recognize the patterns of genetic variation across continents\n\n***\n\nWe will begin by loading the packages that we will need:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nhere() starts at /home\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(readr)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DT)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.0     ✔ tibble    3.3.0\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\ninstall.packages(c(\"patchwork\", \"ggforce\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nInstalling packages into '/usr/local/lib/R/site-library'\n(as 'lib' is unspecified)\nalso installing the dependencies 'tweenr', 'polyclip', 'RcppEigen'\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(patchwork)\nlibrary(ggforce) #for facet_col\n```\n:::\n\n\n Package   | Use\n---------- |-------------\n[here](https://github.com/jennybc/here_here){target=\"_blank\"}       | to easily load and save data\n[readr](https://readr.tidyverse.org/){target=\"_blank\"}              | to import data files\n[dplyr](https://dplyr.tidyverse.org/){target=\"_blank\"}              | to manipulate data\n[tidyverse](https://tidyverse.org/){target=\"_blank\"}                | to manipulate and visualize data\n[patchwork](https://patchwork.data-imaginist.com/){target=\"_blank\"} | to combine plots\n[ggforce](https://ggforce.data-imaginist.com/){target=\"_blank\"}     | to extend the plotting capabilities of ggplot2\n\nThe first time we use a function, we will use the `::` to indicate which package we are using. Unless we have overlapping function names, this is not necessary, but we will include it here to be informative about where the functions we will use come from.\n\n# **Context**\n***\nProvide some more details and background on the case study topic and its relation to public health/the world.\n\n# **Limitations**\n***\n\n# **What are the data?**\n***\n\n# **Data Import**\n***\n\n\n::: {.cell}\n\n```{.r .cell-code}\nancestry_props <-\n  readr::read_table(here(\"data/raw/AGR.without_related_chr10_maf001_LDp50_final_removesmallpops_shrinkBaganda.combined_fam.Q\"), col_names = c(\"pop\", \"id\", paste0(\"k\", 1:7)))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\n── Column specification ────────────────────────────────────────────────────────\ncols(\n  pop = col_character(),\n  id = col_character(),\n  k1 = col_double(),\n  k2 = col_double(),\n  k3 = col_double(),\n  k4 = col_double(),\n  k5 = col_double(),\n  k6 = col_double(),\n  k7 = col_double()\n)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: 5 parsing failures.\n row col  expected    actual                                                                                                       file\n1919  -- 9 columns 3 columns '/home/data/raw/AGR.without_related_chr10_maf001_LDp50_final_removesmallpops_shrinkBaganda.combined_fam.Q'\n1920  -- 9 columns 3 columns '/home/data/raw/AGR.without_related_chr10_maf001_LDp50_final_removesmallpops_shrinkBaganda.combined_fam.Q'\n1921  -- 9 columns 3 columns '/home/data/raw/AGR.without_related_chr10_maf001_LDp50_final_removesmallpops_shrinkBaganda.combined_fam.Q'\n1922  -- 9 columns 3 columns '/home/data/raw/AGR.without_related_chr10_maf001_LDp50_final_removesmallpops_shrinkBaganda.combined_fam.Q'\n1923  -- 9 columns 3 columns '/home/data/raw/AGR.without_related_chr10_maf001_LDp50_final_removesmallpops_shrinkBaganda.combined_fam.Q'\n```\n\n\n:::\n\n```{.r .cell-code}\nancestry_props_prelim <- ancestry_props\n```\n:::\n\n\n# **Data Wrangling**\n***\n\n\n::: {.cell}\n\n```{.r .cell-code}\nancestry_props <- ancestry_props %>%\n         dplyr::mutate(pop = factor(case_when(\n                         pop == \"ACB\" ~ \"African Caribbean\",\n                         pop == \"ASW\" ~ \"African American\",\n                         pop == \"CHB\" ~ \"Han Chinese\",\n                         pop == \"Egyptians\" ~ \"Egyptian\",\n                         pop == \"ESN\" ~ \"Esan\",\n                         pop == \"GBR\" ~ \"British\",\n                         pop == \"GIH\" ~ \"Gujarati\",\n                         pop == \"GWD\" ~ \"Mandinka\",\n                         pop == \"LWK\" ~ \"Luhya\",\n                         pop == \"MSL\" ~ \"Mende\",\n                         pop == \"MXL\" ~ \"Mexican\",\n                         pop == \"Nama/Khoe-San\" ~ \"Nama\",\n                         pop == \"RwandeseUgandan\" ~ \"Rwandese\",\n                         pop == \"uganda_gwas_unknown\" ~ NA_character_,\n                         pop == \"Batooro\" ~ NA_character_,\n                         pop == \"Nyanjiro(Tanzania)\" ~ NA_character_,\n                         pop == \"TSI\" ~ \"Italian\",\n                         pop == \"YRI\" ~ \"Yoruba\",\n                         TRUE ~ pop),\n                      levels = c(\"Nama\", \"Zulu\", \"Mende\", \"Esan\", \"Yoruba\", \"Mandinka\", \"African Caribbean\", \"African American\", \"Banyarwanda\", \"Banyankole\", \"Bakiga\", \"Barundi\", \"Rwandese\", \"Baganda\", \"Luhya\", \"Gumuz\", \"Somali\", \"Wolayta\", \"Oromo\", \"Amhara\", \"Egyptian\", \"Gujarati\", \"Mexican\", \"British\", \"Italian\", \"Han Chinese\"))\n            ) %>%\n  tidyr::drop_na() # dropping a few samples that had no data\n\nancestry_props_temp <- ancestry_props\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.table(ancestry_props, file = here(\"data/wrangled/ADMIXTURE_ancestry_props.Q\"),\n            row.names = FALSE,\n            quote = FALSE,\n            sep = \"\\t\")\n```\n:::\n\n\n# **Data Visualization**\n***\n\nIf you have been following along but stopped, we could load our wrangled data like so:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(here::here(\"data\", \"wrangled\", \"ADMIXTURE_ancestry_props.Q\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot1 <- ancestry_props %>%\n  pivot_longer(starts_with(\"k\"), values_to = \"prop\", names_to = \"which_k\") %>%\n  ggplot(aes(y=id,\n             x=prop,\n             fill = factor(which_k),\n             group = pop)) +\n  geom_bar(stat = \"identity\", position = \"stack\", width = 1) +\n  facet_col(~pop,\n             #ncol=1, #included in facet_wrap, but not facet_col\n             strip.position = \"left\",\n             scales = \"free_y\",\n             space = \"free\") + #argument in facet_col, but not facet_wrap -- better reflects how many samples are in the facet in my opinion\n  theme(axis.text.y = element_blank(),\n        strip.text.y.left = element_text(angle = 0),\n        strip.background = element_blank(),\n        legend.position = \"none\") +\n  ylab(\"\") +\n  scale_fill_manual(breaks = c(\"k6\", \"k7\", \"k1\", \"k4\", \"k5\", \"k3\", \"k2\"),\n                    values = c(\"#2B284B\", \"#FFE6AD\", \"#30A9E1\", \"#056EB5\", \"#2BA06A\", \"#EC5D25\", \"#A41252\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntoPlot <- left_join(ancestry_props_temp %>%\n            select(!starts_with(\"k\")) %>%\n            rownames_to_column(),\n          ancestry_props_temp %>%\n            select(starts_with(\"k\")) %>%\n            mutate(which_k = names(.)[max.col(.)]) %>%\n            rownames_to_column() %>%\n            select(rowname, which_k),\n          by=\"rowname\") %>%\n  group_by(pop, which_k) %>%\n  summarize(count = n()) %>%\n  ungroup() %>%\n  group_by(pop) %>%\n  top_n(1, count) %>%\n  left_join(ancestry_props_temp %>%\n               group_by(pop) %>%\n               summarize(n_ids = n()), by = \"pop\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'pop'. You can override using the `.groups`\nargument.\n```\n\n\n:::\n\n```{.r .cell-code}\ntoPlotExpanded <- toPlot[rep(seq_len(nrow(toPlot)), toPlot$n_ids), c(\"pop\", \"which_k\")]\n\nplot2 <- toPlotExpanded %>%\n  ggplot(aes(x = -1,\n             y = row.names(.),\n             fill = which_k)) +\n  geom_col(width=1) +\n  facet_col(~pop,\n            scales = \"free_y\",\n            space = \"free\"\n            ) +\n  theme_bw() +\n  theme(axis.text = element_blank(),\n        axis.ticks = element_blank(),\n        legend.position = \"none\",\n        strip.background = element_blank(),\n        strip.text.x = element_blank()) +\n  xlab(\"\") +\n  ylab(\"\") +\n  xlim(c(-1,0)) +\n  scale_fill_manual(breaks = c(\"k6\", \"k7\", \"k1\", \"k4\", \"k5\", \"k3\", \"k2\"),\n                    values = c(\"#2B284B\", \"#FFE6AD\", \"#30A9E1\", \"#056EB5\", \"#2BA06A\", \"#EC5D25\", \"#A41252\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot1 + plot2 +\n  plot_layout(widths = c(5,0.5), heights=c(12))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=528}\n:::\n:::\n\n\n# **Analysis**\n***\n\n# **Summary**\n***\n\n# **Suggested Homework**\n***\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}